{
  "dependencies": [
    "@sewellstephens/plate-dnd",
    "react-dnd",
    "react-dnd-html5-backend"
  ],
  "files": [
    {
      "content": "'use client';\n\nimport React from 'react';\n\nimport type { ClassNames, TEditor } from '@sewellstephens/plate-common';\nimport type { DropTargetMonitor } from 'react-dnd';\n\nimport { cn, withRef } from '@sewellstephens/cn';\nimport {\n  type LateElementProps,\n  useEditorRef,\n} from '@sewellstephens/plate-common/react';\nimport {\n  type DragItemNode,\n  useDraggable,\n  useDraggableState,\n} from '@sewellstephens/plate-dnd';\nimport { BlockSelectionPlugin } from '@sewellstephens/plate-selection/react';\n\nimport { Icons } from '@/components/icons';\n\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipPortal,\n  TooltipTrigger,\n} from './tooltip';\n\nexport interface DraggableProps\n  extends LateElementProps,\n    ClassNames<{\n      /** Block. */\n      block: string;\n\n      /** Block and gutter. */\n      blockAndGutter: string;\n\n      /** Block toolbar in the gutter. */\n      blockToolbar: string;\n\n      /**\n       * Block toolbar wrapper in the gutter left. It has the height of a line\n       * of the block.\n       */\n      blockToolbarWrapper: string;\n\n      blockWrapper: string;\n\n      /** Button to dnd the block, in the block toolbar. */\n      dragHandle: string;\n\n      /** Icon of the drag button, in the drag icon. */\n      dragIcon: string;\n\n      /** Show a dropline above or below the block when dragging a block. */\n      dropLine: string;\n\n      /** Gutter at the left side of the editor. It has the height of the block */\n      gutterLeft: string;\n    }> {\n  /**\n   * Intercepts the drop handling. If `false` is returned, the default drop\n   * behavior is called after. If `true` is returned, the default behavior is\n   * not called.\n   */\n  onDropHandler?: (\n    editor: TEditor,\n    props: {\n      dragItem: DragItemNode;\n      id: string;\n      monitor: DropTargetMonitor<DragItemNode, unknown>;\n      nodeRef: any;\n    }\n  ) => boolean;\n}\n\nconst DragHandle = () => {\n  const editor = useEditorRef();\n\n  return (\n    <Tooltip>\n      <TooltipTrigger type=\"button\">\n        <Icons.dragHandle\n          className=\"size-4 text-muted-foreground\"\n          onClick={(event) => {\n            event.stopPropagation();\n            event.preventDefault();\n\n            // if (element.id) {\n            //   editor.getApi(BlockSelectionPlugin).blockSelection.addSelectedRow(element.id as string);\n            //   api.blockContextMenu.show(editor.id, event as any);\n            // }\n          }}\n          onMouseDown={() => {\n            editor\n              .getApi(BlockSelectionPlugin)\n              .blockSelection.resetSelectedIds();\n          }}\n        />\n      </TooltipTrigger>\n      <TooltipPortal>\n        <TooltipContent>Drag to move</TooltipContent>\n      </TooltipPortal>\n    </Tooltip>\n  );\n};\n\nexport const Draggable = withRef<'div', DraggableProps>(\n  ({ className, classNames = {}, onDropHandler, ...props }, ref) => {\n    const { children, element } = props;\n\n    const state = useDraggableState({ element, onDropHandler });\n    const { dropLine, isDragging, isHovered } = state;\n    const {\n      droplineProps,\n      groupProps,\n      gutterLeftProps,\n      handleRef,\n      previewRef,\n    } = useDraggable(state);\n\n    return (\n      <div\n        className={cn(\n          'relative',\n          isDragging && 'opacity-50',\n          'group',\n          className\n        )}\n        ref={ref}\n        {...groupProps}\n      >\n        <div\n          className={cn(\n            'pointer-events-none absolute -top-px z-50 flex h-full -translate-x-full cursor-text opacity-0 group-hover:opacity-100',\n            classNames.gutterLeft\n          )}\n          {...gutterLeftProps}\n        >\n          <div className={cn('flex h-[1.5em]', classNames.blockToolbarWrapper)}>\n            <div\n              className={cn(\n                'pointer-events-auto mr-1 flex items-center',\n                classNames.blockToolbar\n              )}\n            >\n              <div\n                className=\"size-4\"\n                data-key={element.id as string}\n                ref={handleRef}\n              >\n                {isHovered && <DragHandle />}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className={classNames.blockWrapper} ref={previewRef}>\n          {children}\n\n          {!!dropLine && (\n            <div\n              className={cn(\n                'absolute inset-x-0 h-0.5 opacity-100',\n                'bg-ring',\n                dropLine === 'top' && '-top-px',\n                dropLine === 'bottom' && '-bottom-px',\n                classNames.dropLine\n              )}\n              {...droplineProps}\n            />\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n",
      "name": "draggable.tsx"
    },
    {
      "content": "import type { FC } from 'react';\n\nimport { BlockquotePlugin } from '@sewellstephens/plate-block-quote/react';\nimport { CodeBlockPlugin } from '@sewellstephens/plate-code-block/react';\nimport {\n  ParagraphPlugin,\n  createNodesWithHOC,\n} from '@sewellstephens/plate-common/react';\nimport {\n  type WithDraggableOptions,\n  withDraggable as withDraggablePrimitive,\n} from '@sewellstephens/plate-dnd';\nimport { ExcalidrawPlugin } from '@sewellstephens/plate-excalidraw';\nimport { HEADING_KEYS } from '@sewellstephens/plate-heading';\nimport { ColumnPlugin } from '@sewellstephens/plate-layout';\nimport {\n  BulletedListPlugin,\n  NumberedListPlugin,\n} from '@sewellstephens/plate-list/react';\nimport {\n  ImagePlugin,\n  MediaEmbedPlugin,\n  PlaceholderPlugin,\n} from '@sewellstephens/plate-media';\nimport { TablePlugin } from '@sewellstephens/plate-table';\nimport { TogglePlugin } from '@sewellstephens/plate-toggle';\n\nimport { Draggable, type DraggableProps } from './draggable';\n\nexport const withDraggable = (\n  Component: FC,\n  options?: WithDraggableOptions<\n    Partial<Omit<DraggableProps, 'children' | 'editor' | 'element'>>\n  >\n) =>\n  withDraggablePrimitive<DraggableProps>(Draggable, Component, options as any);\n\nexport const withDraggablesPrimitive = createNodesWithHOC(withDraggable);\n\nexport const withDraggables = (components: any) => {\n  return withDraggablesPrimitive(components, [\n    {\n      keys: [\n        ParagraphPlugin.key,\n        BulletedListPlugin.key,\n        NumberedListPlugin.key,\n      ],\n      level: 0,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          blockToolbarWrapper: 'h-[1.3em]',\n          gutterLeft: 'px-0 pb-1 text-[1.875em]',\n        },\n      },\n      key: HEADING_KEYS.h1,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          blockToolbarWrapper: 'h-[1.3em]',\n          gutterLeft: 'px-0 pb-1 text-[1.5em]',\n        },\n      },\n      key: HEADING_KEYS.h2,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          blockToolbarWrapper: 'h-[1.3em]',\n          gutterLeft: 'pt-[2px] px-0 pb-1 text-[1.25em]',\n        },\n      },\n      key: HEADING_KEYS.h3,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          blockToolbarWrapper: 'h-[1.3em]',\n          gutterLeft: 'pt-[3px] px-0 pb-0 text-[1.1em]',\n        },\n      },\n      keys: [HEADING_KEYS.h4, HEADING_KEYS.h5],\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-[3px] px-0 pb-0',\n        },\n      },\n      keys: [ParagraphPlugin.key],\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'px-0 pb-0',\n        },\n      },\n      keys: [HEADING_KEYS.h6, BulletedListPlugin.key, NumberedListPlugin.key],\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'px-0 pb-0',\n        },\n      },\n      key: BlockquotePlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-6 px-0 pb-0',\n        },\n      },\n      key: CodeBlockPlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-0 px-0 pb-0',\n        },\n      },\n      key: ImagePlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-0 px-0 pb-0',\n        },\n      },\n      key: MediaEmbedPlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-0 px-0 pb-0',\n        },\n      },\n      key: ExcalidrawPlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-0 px-0 pb-0',\n        },\n      },\n      key: TogglePlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-0 px-0 pb-0',\n        },\n      },\n      key: ColumnPlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-3 px-0 pb-0',\n        },\n      },\n      key: PlaceholderPlugin.key,\n    },\n    {\n      draggableProps: {\n        classNames: {\n          gutterLeft: 'pt-3 px-0 pb-0',\n        },\n      },\n      key: TablePlugin.key,\n    },\n  ]);\n};\n",
      "name": "with-draggables.tsx"
    }
  ],
  "name": "draggable",
  "registryDependencies": [
    "tooltip"
  ],
  "type": "components:plate-ui"
}